---
output: 
  bookdown::pdf_document2:
    toc: false
    citation_package: natbib
    keep_tex: false
    fig_caption: true
    latex_engine: pdflatex
title: "STP598-Assignment 2"
author: 
- Hao Wang 
- hwang306
date: '`r format(Sys.Date(), "%B %d, %Y")`'
geometry: margin=1in
fontfamily: mathpazo
fontsize: 12pt
spacing: single
papersize: letter
citecolor: blue
header-includes: \usepackage{graphicx, longtable, float, subfigure}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Question 1

# Question 3

Permuation test

```{r}
#generate a random dataset including x and y variables

set.seed(1)
x <- rnorm(100) + 100
y <- rchisq(100, 7)

#spearman correlation
cor.0 <- cor(x, y, method = "spearman")
cor.test(x, y, method = "spearman")

#run a permutation test for 10,000 times
#number of permutations
R <- 10000
reps <- numeric(R)
#create a long vector first
z <- c(x,y) #pooled sample
K <- length(z)
for (i in 1:R) {
#generate indicies k for the first sample
k <- sample(K, size = 100, replace = FALSE)
x1 <- z[k]
y1 <- z[-k] #the rest
reps[i] <- cor(x1, y1, method = "spearman") #spearman test statistics
}

#get empirical p vale
p <- mean(c(cor.0, reps) >= cor.0)
p
```

The empirical test value $\hat{p}$ can be obtained by

$$\hat{p} =  \frac{\{1 + \sum^{B}_{b = 1} I(\hat{\theta}^{(b)}) \geq \hat{\theta} \}} {B + 1}$$
In this equation, B is the number of permutations, $\hat{theta}$ is the test statistics. In my case the test statistics is the spearman correlation test value. The p value I got is `r p`.

And we can get a histogram of the spearman statistics

```{r}
hist(reps, main = "", freq = FALSE, xlab = "Spearman Correlation (p = 0.21)", breaks = "scott") 
points(cor.0, 0, cex = 1, pch = 16) #observed T
```

Thus we cannot reject the null: true spearman correlation is 0. In the orginal spearman test, the p value is 0.422.


